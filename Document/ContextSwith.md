# 上下文切换的时机

1. SysTick 中判断当前任务的时间窗已经用完，发生上下文切换
2. 中断发生，要求处理紧急事务，发生上下文切换
3. 任务执行过程中让出资源，发生上下文切换，比如：
   - delay: 睡眠一段时间
   - yield: 主动让出



# 锁

## spinlock 

不能同时在应用和中断中使用同一个锁，否则因为应用的优先级低，又获得了锁，而导致中断无法完成执行，从而导致系统假死

在不同应用中使用时，可以通过将低优先级的任务提升优先级，从而避免低优先级的任务锁定资源，导致高优先级的任务无法获得执行时间而锁死

## scheduler_disable

关掉调度器，但是中断还是可以打断执行，可以将中断接收到的数据和请求缓存下来，等调度器打开后再处理这些请求



## irq_save/irq_restore

用于关闭中断和打开中断，但是如果系统中有多核或者多个 cpu，这种关中断的方式并不能保证程序执行不被打断